[2025-11-23 13:33:10] [INFO] [transactions] Creating transaction for user abassi.loay@gmail.com
[2025-11-23 13:33:10] [INFO] [transactions] Client profile found: loay abassi
[2025-11-23 13:33:10] [INFO] [transactions] Location validation passed: (33.865728, 10.0466688)
[2025-11-23 13:33:10] [INFO] [transactions] Current transaction location: (33.865728, 10.0466688)
[2025-11-23 13:33:10] [INFO] [transactions] Preserved last known location: (34.727526, 10.744627)
[2025-11-23 13:33:10] [INFO] [transactions] Location tracking: User=abassi.loay@gmail.com, Home=(34.931003, 9.357500), Current transaction=(33.865728, 10.0466688), Last verified=(34.727526, 10.744627)
[2025-11-23 13:33:10] [INFO] [transactions] Transaction created: ID 333, Amount: 200.00, Type: transfer
[2025-11-23 13:33:10] [INFO] [transactions] Transaction location stored: (33.865728, 10.0466688)
[2025-11-23 13:33:10] [INFO] [transactions] Risk assessment: Score=50, Triggers=['‚ö†Ô∏è Effective distance violation: 115.30km > 60.0km threshold'], Requires OTP=True, Decision=Monitor
[2025-11-23 13:33:19] [INFO] [transactions] ML score: 0.5, Contribution: 20, Final risk score: 70
[2025-11-23 13:33:19] [INFO] [transactions] Transaction details: ID=333, Client=loay abassi, Type=transfer, Amount=200.00 DZD, Risk Score=70, Decision=Monitor, Triggers=['‚ö†Ô∏è Effective distance violation: 115.30km > 60.0km threshold']
[2025-11-23 13:33:19] [INFO] [transactions] Transaction | ID: 333 | Amount: 200.00 DZD | Type: transfer | Status: CREATED | Data: {"transaction_id": 333, "amount": "200.00", "transaction_type": "transfer", "user_id": 71, "status": "CREATED", "risk_level": "Score_70"}
[2025-11-23 13:33:19] [INFO] [transactions] OTP decision for transaction 333: Required=True, Reasons=['Business rules triggered: 1', 'High risk score: 70', 'Risk engine explicit requirement']
[2025-11-23 13:33:19] [INFO] [transactions] Creating transaction OTP for transaction 333, user abassi.loay@gmail.com
[2025-11-23 13:33:19] [INFO] [transactions] Created transaction OTP 509605 for transaction 333, expires at 2025-11-23 12:43:19.227962+00:00
[2025-11-23 13:33:21] [ERROR] [transactions] Failed to send transaction OTP email for transaction 333, deleting OTP
[2025-11-23 13:33:21] [ERROR] [transactions] Failed to create OTP for risk-flagged transaction 333
[2025-11-23 14:17:52] [INFO] [transactions] Creating transaction for user abassi.loay@gmail.com
[2025-11-23 14:17:52] [INFO] [transactions] Client profile found: loay abassi
[2025-11-23 14:17:52] [INFO] [transactions] Location validation passed: (33.865728, 10.0466688)
[2025-11-23 14:17:52] [INFO] [transactions] Current transaction location: (33.865728, 10.0466688)
[2025-11-23 14:17:52] [INFO] [transactions] Preserved last known location: (34.727526, 10.744627)
[2025-11-23 14:17:52] [INFO] [transactions] Location tracking: User=abassi.loay@gmail.com, Home=(34.931003, 9.357500), Current transaction=(33.865728, 10.0466688), Last verified=(34.727526, 10.744627)
[2025-11-23 14:17:52] [INFO] [transactions] Transaction created: ID 334, Amount: 200.00, Type: transfer
[2025-11-23 14:17:52] [INFO] [transactions] Transaction location stored: (33.865728, 10.0466688)
[2025-11-23 14:17:52] [INFO] [transactions] Risk assessment: Score=50, Triggers=['‚ö†Ô∏è Effective distance violation: 115.30km > 60.0km threshold'], Requires OTP=True, Decision=Monitor
[2025-11-23 14:17:53] [INFO] [transactions] ML score: 0.5, Contribution: 20, Final risk score: 70
[2025-11-23 14:17:53] [INFO] [transactions] Transaction details: ID=334, Client=loay abassi, Type=transfer, Amount=200.00 DZD, Risk Score=70, Decision=Monitor, Triggers=['‚ö†Ô∏è Effective distance violation: 115.30km > 60.0km threshold']
[2025-11-23 14:17:53] [INFO] [transactions] Transaction | ID: 334 | Amount: 200.00 DZD | Type: transfer | Status: CREATED | Data: {"transaction_id": 334, "amount": "200.00", "transaction_type": "transfer", "user_id": 71, "status": "CREATED", "risk_level": "Score_70"}
[2025-11-23 14:17:53] [INFO] [transactions] OTP decision for transaction 334: Required=True, Reasons=['Business rules triggered: 1', 'High risk score: 70', 'Risk engine explicit requirement']
[2025-11-23 14:17:53] [INFO] [transactions] Creating transaction OTP for transaction 334, user abassi.loay@gmail.com
[2025-11-23 14:17:53] [INFO] [transactions] Created transaction OTP 278497 for transaction 334, expires at 2025-11-23 13:27:53.633342+00:00
[2025-11-23 14:17:53] [INFO] [transactions] Transaction OTP created and sent successfully for transaction 334
[2025-11-23 14:17:53] [INFO] [transactions] Transaction requires OTP verification: ID 334, Risk score: 70, Triggers: 1, ML score: 0.500
[2025-11-23 14:36:38] [INFO] [transactions] Creating transaction for user abassi.loay@gmail.com
[2025-11-23 14:36:38] [INFO] [transactions] Client profile found: loay abassi
[2025-11-23 14:36:38] [INFO] [transactions] Location validation passed: (33.865728, 10.0466688)
[2025-11-23 14:36:38] [INFO] [transactions] Current transaction location: (33.865728, 10.0466688)
[2025-11-23 14:36:38] [INFO] [transactions] Preserved last known location: (34.727526, 10.744627)
[2025-11-23 14:36:38] [INFO] [transactions] Location tracking: User=abassi.loay@gmail.com, Home=(34.931003, 9.357500), Current transaction=(33.865728, 10.0466688), Last verified=(34.727526, 10.744627)
[2025-11-23 14:36:38] [INFO] [transactions] Transaction created: ID 335, Amount: 200.00, Type: transfer
[2025-11-23 14:36:38] [INFO] [transactions] Transaction location stored: (33.865728, 10.0466688)
[2025-11-23 14:36:38] [INFO] [transactions] Risk assessment: Score=50, Triggers=['‚ö†Ô∏è Effective distance violation: 115.30km > 60.0km threshold'], Requires OTP=True, Decision=Monitor
[2025-11-23 14:36:39] [INFO] [transactions] ML score: 0.5, Contribution: 20, Final risk score: 70
[2025-11-23 14:36:39] [INFO] [transactions] Transaction details: ID=335, Client=loay abassi, Type=transfer, Amount=200.00 DZD, Risk Score=70, Decision=Monitor, Triggers=['‚ö†Ô∏è Effective distance violation: 115.30km > 60.0km threshold']
[2025-11-23 14:36:39] [INFO] [transactions] Transaction | ID: 335 | Amount: 200.00 DZD | Type: transfer | Status: CREATED | Data: {"transaction_id": 335, "amount": "200.00", "transaction_type": "transfer", "user_id": 71, "status": "CREATED", "risk_level": "Score_70"}
[2025-11-23 14:36:39] [INFO] [transactions] OTP decision for transaction 335: Required=True, Reasons=['Business rules triggered: 1', 'High risk score: 70', 'Risk engine explicit requirement']
[2025-11-23 14:36:39] [INFO] [transactions] Creating transaction OTP for transaction 335, user abassi.loay@gmail.com
[2025-11-23 14:36:39] [INFO] [transactions] Created transaction OTP 122195 for transaction 335, expires at 2025-11-23 13:46:39.956796+00:00
[2025-11-23 14:36:39] [INFO] [transactions] Transaction OTP created and sent successfully for transaction 335
[2025-11-23 14:36:39] [INFO] [transactions] Transaction requires OTP verification: ID 335, Risk score: 70, Triggers: 1, ML score: 0.500
[2025-11-23 14:37:15] [INFO] [transactions] Verifying transaction OTP for transaction 335, user abassi.loay@gmail.com
[2025-11-23 14:37:15] [INFO] [transactions] Transaction OTP verified successfully for transaction 335
[2025-11-23 14:37:15] [INFO] [transactions] üîê OTP SUCCESS: Updated last known location to (33.865728, 10.046669) for user abassi.loay@gmail.com after successful OTP verification
[2025-11-23 14:37:15] [INFO] [transactions] Updating balances for transaction 335
[2025-11-23 14:37:15] [INFO] [transactions] Current balance: 699966900.00, Amount: 200.00
[2025-11-23 14:37:15] [INFO] [transactions] Transfer (sender): New balance = 699966700.00
[2025-11-23 14:37:15] [WARNING] [transactions] Recipient account 11111111 not found for transfer
[2025-11-23 14:37:15] [INFO] [transactions] Updating statistics for client loay abassi
[2025-11-23 14:37:15] [INFO] [transactions] Statistics updated for loay abassi: avg_amount=4728.57142857143, std_amount=4301.06773644282, transaction_count=7
[2025-11-23 14:37:15] [INFO] [transactions] Balance update completed for client loay abassi. New balance: 699966700.00 DZD
[2025-11-23 14:37:15] [INFO] [transactions] Transaction 335 completed after OTP verification
[2025-11-23 14:37:15] [ERROR] [transactions] Error completing transaction after OTP verification: name 'send_transaction_notification' is not defined
[2025-11-23 14:37:17] [INFO] [transactions] Verifying transaction OTP for transaction 335, user abassi.loay@gmail.com
[2025-11-23 14:37:17] [WARNING] [transactions] No valid OTP found for transaction 335, user abassi.loay@gmail.com
